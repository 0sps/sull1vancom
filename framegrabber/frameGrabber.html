<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <title>Frame Grabber</title>
    <style>
        :root {
            /* iOS System Colors - Dark Mode Base */
            --ios-bg: #000000;
            --ios-card: rgba(30, 30, 35, 0.6);
            --ios-blue: #0a84ff;
            --ios-blue-glass: rgba(10, 132, 255, 0.5);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --radius-l: 16px;
            --radius-xl: 32px;
            --spring: cubic-bezier(0.25, 1, 0.5, 1);

            /* Dynamic Solar Variables */
            --sky-color-1: #141617;
            --sky-color-2: #2d3428;
            --sky-color-3: #7a6332;
            --sky-color-4: #db6b0d;
            --sky-color-5: #1a0b00;
            --sky-color-6: #000000;
            --sky-stop-1: 0%;
            --sky-stop-2: 50%;
            --sky-stop-3: 80%;
            --sky-stop-4: 85%;
            --sky-stop-5: 87.5%;
            --sky-stop-6: 90%;

            --sun-x: 85%;
            --sun-y: 87.5%;
            --sun-color: #ffffff;
            --sun-glow-1: #ffcc33;
            --sun-glow-2: #ff6600;
            --sun-glow-3: rgba(255, 102, 0, 0.6);
            --sun-blur: 6px;

            --horizon-y: 85.5%;
            --horizon-color: rgba(255, 140, 0, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
        }

        html {
            min-height: 100dvh;
            width: 100%;
            overflow-x: hidden;
        }

        /* Updated Atmospheric Background */
        body {
            min-height: 100dvh;
            padding-bottom: env(safe-area-inset-bottom);
            background: #000;
            overflow-x: hidden;
        }

        .sky-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(to bottom,
                    var(--sky-color-1) var(--sky-stop-1),
                    var(--sky-color-2) var(--sky-stop-2),
                    var(--sky-color-3) var(--sky-stop-3),
                    var(--sky-color-4) var(--sky-stop-4),
                    var(--sky-color-5) var(--sky-stop-5),
                    var(--sky-color-6) var(--sky-stop-6));
            overflow: hidden;
        }

        .sun {
            position: absolute;
            top: var(--sun-y);
            left: var(--sun-x);
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: var(--sun-color);
            border-radius: 50%;
            box-shadow:
                0 0 40px var(--sun-color),
                0 0 70px var(--sun-glow-1),
                0 0 120px var(--sun-glow-2),
                0 0 200px var(--sun-glow-3);
            filter: blur(var(--sun-blur));
        }

        .horizon-glow {
            position: absolute;
            top: var(--horizon-y);
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, transparent, var(--horizon-color), transparent);
            filter: blur(8px);
            transform: translateY(-50%);
        }

        /* Header - Deleted as per request, but keeping back btn style for player */
        .header-back-btn {
            position: fixed;
            top: calc(15px + env(safe-area-inset-top));
            left: 20px;
            background: rgba(40, 60, 80, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 1001;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .header-back-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .container {
            min-height: 100dvh;
            padding: 20px 16px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            /* Vertical Centering */
            gap: 24px;
        }

        /* Upload Area */
        .upload-card {
            width: 93%;
            height: 60dvh;
            /* 80% of device screen height */
            background: rgba(30, 35, 45, 0.12);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 40px;
            /* Slightly more rounded for large card */
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 24px;
            cursor: pointer;
            transition: transform 0.2s var(--spring), background 0.2s var(--spring), border-color 0.2s var(--spring);
            padding: 40px;
            box-shadow: 0 20px 60px -20px rgba(0, 0, 0, 0.4);
            /* Prevent image/text drag-selection */
            -webkit-user-drag: none;
        }

        .upload-card:active {
            transform: scale(0.96);
            background: rgba(50, 50, 55, 0.4);
            border-color: rgba(255, 255, 255, 0.4);
            transition: transform 0.1s var(--spring);
        }

        .upload-icon {
            font-size: 48px;
            background: linear-gradient(135deg, var(--ios-blue), #64d2ff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 4px 12px rgba(10, 132, 255, 0.3));
        }

        .upload-text {
            font-size: 19px;
            font-weight: 600;
            color: white;
        }

        #videoInput {
            display: none;
        }

        /* Player Area */
        .player-container {
            width: 100%;
            background: rgba(0, 0, 0, 0.25);
            /* More transparent */
            border-radius: var(--radius-xl);
            overflow: hidden;
            display: none;
            flex-direction: column;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 30px 80px -20px rgba(0, 0, 0, 0.6);
        }

        video {
            width: 100%;
            height: auto;
            max-height: 65vh;
            display: block;
        }

        .controls {
            padding: 24px 20px 30px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            /* Ultra glass look */
            background: rgba(20, 20, 30, 0.2);
            /* More transparent */
            backdrop-filter: blur(35px);
            -webkit-backdrop-filter: blur(35px);
            border-top: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* Range Slider */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            background: transparent;
            height: 30px;
            /* larger touch target */
        }

        input[type=range]:focus {
            outline: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 36px;
            width: 36px;
            border-radius: 50%;
            margin-top: -16px;
            cursor: pointer;

            /* Glass orb look */
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow:
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 10px 10px rgba(255, 255, 255, 0.2),
                inset 0 -5px 10px rgba(0, 0, 0, 0.1);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 2px;
        }

        .time-display {
            font-family: "SF Mono", SFMono-Regular, ui-monospace, monospace;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            text-align: center;
            font-variant-numeric: tabular-nums;
            background: rgba(0, 0, 0, 0.15);
            padding: 6px 14px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);
        }

        .button-row {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 8px;
        }

        .btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.05);
            color: white;
            padding: 16px 24px;
            border-radius: 20px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s var(--spring);
            flex: 1;
            max-width: 200px;
        }

        .btn:active {
            transform: scale(0.96);
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-primary {
            /* 3D Glassy Blue */
            background: linear-gradient(180deg, rgba(10, 132, 255, 0.6) 0%, rgba(10, 132, 255, 0.4) 100%);
            border: 1px solid rgba(150, 200, 255, 0.3);
            box-shadow:
                0 8px 24px -6px rgba(10, 132, 255, 0.6),
                inset 0 1px 1px rgba(255, 255, 255, 0.4),
                inset 0 -2px 5px rgba(0, 0, 0, 0.1);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .btn-primary:active {
            box-shadow:
                0 4px 12px -4px rgba(10, 132, 255, 0.6),
                inset 0 2px 10px rgba(0, 0, 0, 0.2);
            opacity: 1;
            /* override default */
        }

        .fine-tune {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            padding: 0 10px;
        }

        .fine-tune-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.08);
            /* faint glass */
            border: 1px solid rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            /* Fix iOS double tap zoom */
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        .fine-tune-btn:active {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(0.92);
        }

        /* Canvas (Hidden Frame Grabber) */
        #canvas {
            display: none;
        }



        /* Floating action button area for save */
        .save-area {
            position: fixed;
            bottom: max(30px, env(safe-area-inset-bottom));
            left: 20px;
            right: 20px;
            z-index: 100;
        }

        .save-btn {
            width: 100%;
            padding: 18px;
            /* 3D Glassy Blue Match */
            background: linear-gradient(180deg, rgba(10, 132, 255, 0.7) 0%, rgba(10, 132, 255, 0.5) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            border: 1px solid rgba(150, 200, 255, 0.3);
            border-radius: 20px;
            font-size: 18px;
            font-weight: 700;
            box-shadow: 0 10px 30px -5px rgba(10, 132, 255, 0.5);
            display: none;
            /* Hidden until frame selected */
            transition: transform 0.2s var(--spring);
        }

        .save-btn:active {
            transform: scale(0.98);
        }

        .instructions {
            font-size: 15px;
            color: var(--text-secondary);
            text-align: center;
            max-width: 300px;
            line-height: 1.5;
            font-weight: 400;
        }
    </style>
</head>

<body>

    <!-- Atmospheric Sky Background -->
    <div class="sky-container">
        <div class="sun"></div>
        <div class="horizon-glow"></div>
    </div>
    <button class="header-back-btn" id="backBtn" onclick="resetApp()">
        <svg viewBox="0 0 24 24">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path>
        </svg>
    </button>

    <div class="container">
        <!-- Upload -->
        <div class="upload-card" onclick="document.getElementById('videoInput').click()">
            <div class="upload-icon">‚èè</div>
            <div class="upload-text">Tap to Select Video</div>
            <div class="instructions">Choose a video from your Photo Library to extract high-quality frames.</div>
            <input type="file" id="videoInput" accept="video/*">
        </div>

        <!-- Video Player -->
        <div class="player-container" id="playerContainer">
            <video id="videoElement" playsinline webkit-playsinline preload="metadata"></video>

            <div class="controls">
                <input type="range" id="scrubber" min="0" max="100" step="0.01" value="0">

                <div class="fine-tune">
                    <button class="fine-tune-btn" id="prevFrame" onclick="seek(-1/30)">-</button>
                    <div class="time-display" id="timeDisplay">0.00s</div>
                    <button class="fine-tune-btn" id="nextFrame" onclick="seek(1/30)">+</button>
                </div>

                <div class="button-row">
                    <!-- <button class="btn" onclick="togglePlay()">Play/Pause</button> -->
                    <button class="btn btn-primary" onclick="grabFrame()">Grab Frame</button>
                </div>
            </div>
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <div class="save-area">
        <button class="save-btn" id="saveBtn" onclick="downloadFrame()">Download Frame</button>
    </div>

    <script>


        /* Dynamic Atmosphere System */
        function updateAtmosphere() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const currentTime = hours + minutes / 60;

            // Sunrise/Sunset at 6am/6pm (6 and 18)
            // Midday at 12pm (12)

            // We want t=0 at 6am/6pm and t=1 at 12pm
            let t = 0;
            if (currentTime >= 6 && currentTime <= 18) {
                // Calculate distance from 12pm (range is 6 to 18, peak at 12)
                t = 1 - Math.abs(currentTime - 12) / 6;
            } else {
                // Night time (simplified: stay at t=0 or go even darker if we wanted)
                t = 0;
            }

            // Interpolation helper
            const lerpColor = (c1, c2, f) => {
                const fixHex = (hex) => {
                    if (hex.length === 4) {
                        return '#' + hex[1] + hex[1] + hex[2] + hex[2] + hex[3] + hex[3];
                    }
                    return hex;
                };
                const hex1 = fixHex(c1);
                const hex2 = fixHex(c2);

                const r1 = parseInt(hex1.substring(1, 3), 16);
                const g1 = parseInt(hex1.substring(3, 5), 16);
                const b1 = parseInt(hex1.substring(5, 7), 16);
                const r2 = parseInt(hex2.substring(1, 3), 16);
                const g2 = parseInt(hex2.substring(3, 5), 16);
                const b2 = parseInt(hex2.substring(5, 7), 16);

                const r = Math.round(r1 + (r2 - r1) * f);
                const g = Math.round(g1 + (g2 - g1) * f);
                const b = Math.round(b1 + (b2 - b1) * f);

                const toHex = (num) => Math.max(0, Math.min(255, num)).toString(16).padStart(2, '0');
                return '#' + toHex(r) + toHex(g) + toHex(b);
            };

            const root = document.documentElement;

            // Define states
            const horizon = {
                sky: ['#141617', '#2d3428', '#7a6332', '#db6b0d', '#1a0b00', '#000000'],
                stops: ['0%', '50%', '80%', '85%', '87.5%', '90%'],
                sunX: '85%', sunY: '87.5%', sunBlur: '6px',
                sunColor: '#ffffff', glow1: '#ffcc33', glow2: '#ff6600', glow3: 'rgba(255, 102, 0, 0.6)',
                horizonY: '85.5%', horizonColor: 'rgba(255, 140, 0, 0.8)'
            };

            const midday = {
                sky: ['#0a2e5c', '#1e5799', '#7db9e8', '#ffffff', '#000000', '#000000'],
                stops: ['0%', '30%', '70%', '85%', '85.1%', '90%'],
                sunX: '50%', sunY: '25%', sunBlur: '2px',
                sunColor: '#ffffff', glow1: '#ffffff', glow2: '#e0f0ff', glow3: 'rgba(255, 255, 255, 0.3)',
                horizonY: '85%', horizonColor: 'rgba(255, 255, 255, 0.4)'
            };

            // Apply interpolated values
            for (let i = 0; i < 6; i++) {
                root.style.setProperty(`--sky-color-${i + 1}`, lerpColor(horizon.sky[i], midday.sky[i], t));
                root.style.setProperty(`--sky-stop-${i + 1}`, (parseFloat(horizon.stops[i]) + (parseFloat(midday.stops[i]) - parseFloat(horizon.stops[i])) * t) + '%');
            }

            root.style.setProperty('--sun-x', (parseFloat(horizon.sunX) + (parseFloat(midday.sunX) - parseFloat(horizon.sunX)) * t) + '%');
            root.style.setProperty('--sun-y', (parseFloat(horizon.sunY) + (parseFloat(midday.sunY) - parseFloat(horizon.sunY)) * t) + '%');
            root.style.setProperty('--sun-blur', (parseFloat(horizon.sunBlur) + (parseFloat(midday.sunBlur) - parseFloat(horizon.sunBlur)) * t) + 'px');

            root.style.setProperty('--horizon-y', (parseFloat(horizon.horizonY) + (parseFloat(midday.horizonY) - parseFloat(horizon.horizonY)) * t) + '%');

            // Colors and RGBA are trickier to lerp perfectly but let's do the basics
            root.style.setProperty('--sun-color', lerpColor(horizon.sunColor, midday.sunColor, t));
            root.style.setProperty('--sun-glow-1', lerpColor(horizon.glow1, midday.glow1, t));
            root.style.setProperty('--sun-glow-2', lerpColor(horizon.glow2, midday.glow2, t));
            // simplified alpha lerp for glow 3
            root.style.setProperty('--sun-glow-3', t > 0.5 ? midday.glow3 : horizon.glow3);
            root.style.setProperty('--horizon-color', t > 0.5 ? midday.horizonColor : horizon.horizonColor);
        }

        // Initialize and update every minute
        window.addEventListener('load', () => {
            updateAtmosphere();
            setInterval(updateAtmosphere, 60000);
        });

        /* App Logic */
        const videoInput = document.getElementById('videoInput');
        const video = document.getElementById('videoElement');
        const playerContainer = document.getElementById('playerContainer');
        const uploadCard = document.querySelector('.upload-card');
        const scrubber = document.getElementById('scrubber');
        const timeDisplay = document.getElementById('timeDisplay');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const saveBtn = document.getElementById('saveBtn');
        const backBtn = document.getElementById('backBtn');

        let videoBlobUrl = null;

        videoInput.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                if (videoBlobUrl) URL.revokeObjectURL(videoBlobUrl);
                videoBlobUrl = URL.createObjectURL(file);
                video.src = videoBlobUrl;

                // Show player, hide upload prompt
                playerContainer.style.display = 'flex';
                uploadCard.style.display = 'none';
                saveBtn.style.display = 'none';
                backBtn.style.display = 'flex';

                // Reset
                video.currentTime = 0;
            }
        });

        function resetApp() {
            video.pause();
            video.src = "";
            if (videoBlobUrl) {
                URL.revokeObjectURL(videoBlobUrl);
                videoBlobUrl = null;
            }
            videoInput.value = ""; // Clear input to allow re-selecting same file

            playerContainer.style.display = 'none';
            uploadCard.style.display = 'flex';
            saveBtn.style.display = 'none';
            backBtn.style.display = 'none';
        }

        video.addEventListener('loadedmetadata', function () {
            scrubber.max = video.duration;
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
        });

        video.addEventListener('timeupdate', function () {
            scrubber.value = video.currentTime;
            timeDisplay.textContent = video.currentTime.toFixed(3) + 's';
        });

        scrubber.addEventListener('input', function () {
            video.currentTime = parseFloat(this.value);
            // Hide save button if scrubbing
            saveBtn.style.display = 'none';
        });

        function seek(delta) {
            video.currentTime = Math.min(Math.max(video.currentTime + delta, 0), video.duration);
            saveBtn.style.display = 'none';
        }

        function grabFrame() {
            if (video.readyState < 2) return;

            // Draw exact match of video resolution
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Pulse animation or haptic feedback visual
            const btn = document.querySelector('.btn-primary');
            const originalText = btn.innerText;
            btn.innerText = "Captured!";
            setTimeout(() => btn.innerText = originalText, 1000);

            // Show download button
            saveBtn.innerText = `Download (${video.videoWidth}x${video.videoHeight})`;
            saveBtn.style.display = 'block';
        }

        function downloadFrame() {
            // Convert to blob and download
            canvas.toBlob(function (blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                // Timestamp filename
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                a.download = `frame_${timestamp}.png`;
                document.body.appendChild(a);
                a.click();
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            }, 'image/png');
        }

        // Clean up
        window.addEventListener('beforeunload', () => {
            if (videoBlobUrl) URL.revokeObjectURL(videoBlobUrl);
        });
    </script>
</body>

</html>